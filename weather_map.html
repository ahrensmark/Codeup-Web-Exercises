<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>San Antonio Weather</title>

    <link rel="stylesheet" href="https://stackpath.bootstrapcdn.com/bootstrap/4.2.1/css/bootstrap.min.css" integrity="sha384-GJzZqFGwb1QTTN6wy59ffF1BuGJpLSa9DkKMp0DgiMDm4iYMj70gZWKYbI706tWS" crossorigin="anonymous">
    <link href='https://api.tiles.mapbox.com/mapbox-gl-js/v1.1.0/mapbox-gl.css' rel='stylesheet' />
    <link rel="stylesheet" href="css/weather_map.css">
</head>
<!--Create a new HTML file called weather_map.html.-->

<!--Using HTML, CSS, jQuery, Ajax, and the Dark Sky API, start by showing the current conditions for San Antonio on your page.-->

<!--Update your layout and Ajax request(s) to display a three-day forecast for San Antonio that looks like the screenshot below, minus icons.-->

<!--3 Day Forecast-->

<!--Include icons:-->
<!--Download the weather icons of your choosing locally and store in a folder in your project called icon. Climacons would be a great choice.-->

<!--Create an array of JS objects containing a property for each of the following conditions: clear-day, clear-night, rain, snow, sleet, wind, fog, cloudy, partly-cloudy-day, partly-cloudy-night.-->

<!--Add a property to the array of icon objects for the url to the location that the appropriate icon is stored locally.-->

<!--Use jQuery to add any icons needed to the document.-->

<!--Create input boxes for "Latitude" and "Longitude" and a <button> that will take the values from those inputs and feed them into your API request.-->

<!--    Refer back to your Mapbox Maps API exercise. Recreate the map below your three-day forecast. Draw the map with a draggable marker starting on San Antonio. Once the user stops dragging the pin, grab its coordinates and feed those into your Dark Sky API. Update the three-day forecast with the information from those coordinates (you should also get rid of your input boxes at this point).-->

<!--    3 Day Forecast Map-->

<!--    Add a Mapbox text input to search by location and have the forecast update when a new location is searched.-->

<!--    As you complete each step, commit your changes and push them to GitHub.-->
<body>
    <div></div>
        <h1 id="moveRight">Weather Application</h1>
        <h2>For San Antonio Texas</h2>
    <br>
    <div class="container">
        <div class="row text-center" id="forecastInfo">
<!--            <div class="col-4">yes</div>-->
<!--            <div class="col-4">no</div>-->


        </div>
    </div>

    <br>
<!--Mapbox map HTML    -->
<!--    <h1>My First Mapbox Map!</h1>-->
    <label for="latitude">Enter Latitude</label>
    <input type="number" id="latitude" name="latitude">
    <input type="submit">
    <br>
    <label for="longitude">Enter longitude</label>
    <input type="number" id="longitude" name="longitude">
    <input type="submit">
    <br>
    <!-- The HTML element that serves as the Mapbox container -->
    <section id='map' class="mapWidth"></section>


    <button id="weather1">Click to update</button>

    <script src="js/keys.js"></script>
    <script src="js/jquery.js"></script>
    <script src='https://api.tiles.mapbox.com/mapbox-gl-js/v0.53.0/mapbox-gl.js'></script>
    <script src="js/mapbox-geocoder-utils.js"></script>

    <script>
        (function() {
            "use strict";

            function updatePage() {


                //get request for forecast data
                $.get("https://cors-anywhere.herokuapp.com/https://api.darksky.net/forecast/" + darkSkyToken + "/29.4241,-98.4936").done(function (data) {
                    var html = buildHTML(data);
                    console.log(data);
                    // var dateObject = new Date(data.currently.time * 1000);
                    // console.log(dateObject);

                    $('#forecastInfo').html(html);
                });
            }

            //build current weather
            updatePage();
            // function buildHTML(current) {
            //     console.log(current.currently);
            //     console.log(current.currently.temperature);
            //     var todayHTML = "";
            //         todayHTML +=  "<div>" + "<h2>" + current.currently.temperature.toFixed(0) + "</h2>" + "</div>";
            //         todayHTML +=  "<div>" +  current.currently.summary + "</div>";
            //         todayHTML +=  "<div>" + "<b>Humidity: </b>" + current.currently.humidity * 100 + "%" + "</div>";
            //         todayHTML +=  "<div>" + "<b>Wind Speed: </b>" + current.currently.windSpeed.toFixed(0) + "</div>";
            //         todayHTML +=  "<div>" +  "<b>Pressure: </b>" +current.currently.pressure + "</div>";
            //
            //     return todayHTML;
            // }
            $('#weather1').click(updatePage);

            //Build 3 day forecast
            var icons = [
                { forecasted: "clear-day",
                  url:  "img/weather-icons/svg/wi-day-sunny.svg"},
                { forecasted: "clear-night",
                  url:  "img/weather-icons/svg/wi-night-clear.svg"},
                { forecasted: "rain",
                  url:  "img/weather-icons/svg/wi-rain.svg"},
                {  forecasted: "snow",
                  url:  "img/weather-icons/svg/wi-snow.svg"},
                { forecasted: "sleet",
                  url:  "img/weather-icons/svg/wi-sleet.svg"},
                { forecasted: "wind",
                  url:  "img/weather-icons/svg/wi-strong-wind.svg"},
                { forecasted: "fog",
                  url:  "img/weather-icons/svg/wi-fog.svg"},
                { forecasted: "cloudy",
                  url:  "img/weather-icons/svg/wi-cloud.svg"},
                { forecasted: "partly-cloudy-day",
                  url:  "img/weather-icons/svg/wi-day-sunny-overcast.svg"},
                { forecasted: "partly-cloudy-night",
                  url:  "img/weather-icons/svg/wi-night-alt-partly-cloudy.svg"}
                ];
            //iterate through icons array to match summary return.
            function iconArray(forecast) {
                for (var j = 0; j < icons.length; j++) {
                    if (forecast.icon === icons[j].forecasted) {
                        console.log(true);
                    }
                }
            }
            function buildHTML(forecast) {
                var forecastsHTML = "";
                for (var i = 0; i < 3; i++) {
                    forecastsHTML += "<div class='col-4 border border-dark' id='bgColor'> <h3>" + forecast.daily.data[i].temperatureHigh.toFixed(0) + "°" + "/" + forecast.daily.data[i].temperatureLow.toFixed(0) + "°" + "</h3>";
                    iconArray(forecast.daily.data[i]);
                    //forecastsHTML += "<p><img src='" + icons.url + "' alt='" +  "'/></p>";
                    forecastsHTML += "<p>" + 'Forecast: ' + forecast.daily.data[i].icon + "</p>";
                    forecastsHTML += "<p>" + 'Humidity: ' + forecast.daily.data[i].humidity + "</p>";
                    forecastsHTML += "<p>" + 'Wind: ' + forecast.daily.data[i].wind + "</p>";
                    forecastsHTML += "<p>" + 'Pressure: ' + forecast.daily.data[i].pressure + "</p></div>";
                }
                //"<td><img src='" + product.url+"' alt='"+ "'/>"
            return forecastsHTML;
            }


            // var map = new mapboxgl.Map({
            //     container: 'map',
            //     style: 'mapbox://styles/mapbox/streets-v9',
            //     zoom: 10,
            //     center: [-98.4916, 29.4252]
            // });
            mapboxgl.accessToken = mapboxToken;
            var coordinates = document.getElementById('coordinates');
            var map = new mapboxgl.Map({
                container: 'map',
                style: 'mapbox://styles/mapbox/streets-v11',
                center: [-98.4916, 29.4252],
                zoom: 4
            });

            var marker = new mapboxgl.Marker({
                draggable: true
            })
                .setLngLat([-98.4916, 29.4252])
                .addTo(map);

            function onDragEnd() {
                var lngLat = marker.getLngLat();
                coordinates.style.display = 'block';
                coordinates.innerHTML = 'Longitude: ' + lngLat.lng + '<br />Latitude: ' + lngLat.lat;
            }

            marker.on('dragend', onDragEnd);
            function geocode(search, token) {
                var baseUrl = 'https://api.mapbox.com';
                var endPoint = '/geocoding/v5/mapbox.places/';
                return fetch(baseUrl + endPoint + encodeURIComponent(search) + '.json' + "?" + 'access_token=' + token)
                    .then(function(res) {
                        return res.json();
                        // to get all the data from the request, comment out the following three lines...
                    }).then(function(data) {
                        return data.features[0].center;
                    });
            }


    })();
    </script>
</body>
</html>